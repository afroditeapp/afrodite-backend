/*
 * afrodite-backend
 *
 * Dating app backend API
 *
 * The version of the OpenAPI document: 0.1.0
 * 
 * Generated by: https://openapi-generator.tech
 */


use reqwest;
use serde::{Deserialize, Serialize, de::Error as _};
use crate::{apis::ResponseContent, models};
use super::{Error, configuration, ContentType};


/// struct for typed errors of method [`get_backup_transfer`]
#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(untagged)]
pub enum GetBackupTransferError {
    Status401(),
    Status500(),
    UnknownValue(serde_json::Value),
}


/// This WebSocket connection facilitates secure backup transfer between two clients: a target client (receiving data) and a source client (sending data).  Header `Sec-WebSocket-Protocol` must have `v1` as the first value.  ## Target Client Flow: 1. Connect and send initial JSON message [BackupTransferInitialMessage] with [ClientRole::Target] 2. Wait for source to connect (timeout: 1 hour). Sending empty    binary messages is possible to test connectivity. 3. Receive byte count JSON message [model_chat::BackupTransferByteCount] 4. Receive binary messages until all bytes transferred  ## Source Client Flow: 1. Connect and send initial JSON message [BackupTransferInitialMessage] with    [ClientRole::Source] (must connect after target).    Note: Response has constant 1-second delay.    Connection closes if [BackupTransferInitialMessage::data_sha256] is invalid    or target is not connected. 2. Receive data JSON message [BackupTransferData] 3. Send byte count JSON message [model_chat::BackupTransferByteCount] 4. Send binary messages containing the data until all bytes transferred.    Max size for a binary message is 64 KiB. Server will stop the data    transfer if binary message size is larger than the max size.  ## WebSocket Close Status Codes: - 1000 (Normal Closure): Transfer completed successfully - 1008 (Policy Violation): Yearly transfer budget exceeded - No close status code: Other error
pub async fn get_backup_transfer(configuration: &configuration::Configuration, ) -> Result<(), Error<GetBackupTransferError>> {

    let uri_str = format!("{}/chat_api/backup_transfer", configuration.base_path);
    let mut req_builder = configuration.client.request(reqwest::Method::GET, &uri_str);

    if let Some(ref user_agent) = configuration.user_agent {
        req_builder = req_builder.header(reqwest::header::USER_AGENT, user_agent.clone());
    }

    let req = req_builder.build()?;
    let resp = configuration.client.execute(req).await?;

    let status = resp.status();

    if !status.is_client_error() && !status.is_server_error() {
        Ok(())
    } else {
        let content = resp.text().await?;
        let entity: Option<GetBackupTransferError> = serde_json::from_str(&content).ok();
        Err(Error::ResponseError(ResponseContent { status, content, entity }))
    }
}

